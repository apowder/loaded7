<?xml version="1.0" encoding="UTF-8"?>
<modification>
  <id>Admin Orders Mods</id>
  <version>1.0.0</version>
  <vqmver>2.3.2</vqmver>
  <author>loadedcommerce.com</author>
  <file name="includes/applications/orders/classes/orders.php">    
   <operation info="PO Mod 1">
      <search position="before"><![CDATA[} else if (isset($_GET['cSearch']) && $_GET['cSearch'] != null) {]]></search>         
      <add><![CDATA[if (utility::isB2B()) {	$sWhere .= " OR pos.po_number LIKE '%" . $_GET['sSearch'] . "%' and o.orders_id = pos.orders_id";	}]]></add>
    </operation> 
    <operation info="PO Mod 2">
      <search position="after" offset = "7"><![CDATA[
      /* Total Filtered Records */
      ]]></search>         
      <add><![CDATA[
      */
      ]]></add>
    </operation>  
    <operation info="PO Mod 3">
      <search position="after" ><![CDATA[
      /* Total Filtered Records */
      ]]></search>         
      <add><![CDATA[
      $QresultFilterTotal = $lC_Database->query("SELECT count(o.orders_id) as total  
                                                 from  ");
      //Purchase Orders Service Module(PO) START
      if (utility::isB2B()) {	
        $QresultFilterTotal->appendQuery(' :table_purchase_orders_service pos, '); 
        $QresultFilterTotal->bindTable(':table_purchase_orders_service',DB_TABLE_PREFIX.'purchase_orders_service');
      }
      //Purchase Orders Service Module(PO) END

      $QresultFilterTotal->appendQuery(" :table_orders o LEFT JOIN :table_orders_total ot 
                                                   on (o.orders_id = ot.orders_id and ot.class = 'total')
                                                 LEFT JOIN :table_orders_status s 
                                                   on (s.orders_status_id = o.orders_status and s.language_id = :language_id) " . 
                                                 $sWhere ." group by o.orders_id ");
      /*
      ]]></add>
    </operation> 
    <operation info="PO Mod 4">
      <search position="after" offset = "7"><![CDATA[
      /* Main Listing Query */
      ]]></search>         
      <add><![CDATA[
      */
      ]]></add>
    </operation>  
    
    <operation info="PO Mod 5">
      <search position="after" ><![CDATA[
      /* Main Listing Query */
      ]]></search>         
      <add><![CDATA[
       $Qresult = $lC_Database->query("SELECT o.orders_id, o.customers_id, o.customers_ip_address, o.customers_name, o.payment_method, o.date_purchased, o.last_modified, o.customers_country_iso3, greatest(date_purchased, coalesce(last_modified, date_purchased)) as date_sort, o.currency, o.currency_value, ot.value as order_total, s.orders_status_name, s.orders_status_type from ");
    
      //Purchase Orders Service Module(PO) START
      if (utility::isB2B()) {	
        $Qresult->appendQuery(' :table_purchase_orders_service pos, '); 
        $Qresult->bindTable(':table_purchase_orders_service',DB_TABLE_PREFIX.'purchase_orders_service');
      }
      //Purchase Orders Service Module(PO) END

      $Qresult->appendQuery(" :table_orders o 
                                   LEFT JOIN :table_orders_total ot 
                                          on (o.orders_id = ot.orders_id and ot.class = 'total')
                                   LEFT JOIN :table_orders_status s 
                                          on (s.orders_status_id = o.orders_status and s.language_id = :language_id) " . 
                                      $sWhere . " group by o.orders_id " . $sOrder  . $sLimit);
      /*
      ]]></add>
    </operation>  
  </file>
</modification>